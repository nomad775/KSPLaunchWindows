<html>
    <head>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        
        <style>
            #viewer{
                width: 50%;
                border-width: 10px;
                border-color: red;
                background-color: none;
                margin: 10;
            }
            
            .button{
                font-size: 24pt;
                
            }
            
        </style>
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script>
            
            var r = 10;
            var scaleFactor = 1;
            
            var planet;
            var sma;
            var LnPe;
            var ecx;
            var ecy;
            
            function scale(value){
                value=Math.round(value/1e6)/1e2;
                return value * scaleFactor;
            }
            
            function drawOrbits(){
                
                planet = planets[6];
                sma = planet.sma;
                
                var ecc = planet.ecc;
                var c =  planet.c;
                var ap = sma+c;
                var pe = sma-c;
                var LnPe = planet.LnPe;
                var mean0 = planet.mean0;
                
                var l = sma*(1-ecc**2);
                var b = sma * Math.sqrt(1-ecc**2);
                var r = l/(1 + ecc * Math.cos(pi/2));
                
                console.log("l", l);
                console.log("b", b);
                console.log("r",r );
                
                console.log("", planet.rAtLn(LnPe + pi/2));
                
                
                scaleFactor = 250/scale(ap+c);
                sma=scale(sma);
                c = scale(c);
                ap = scale(ap);
                pe = scale(pe);
                
                var minA = sma*Math.sqrt(1-ecc**2);
                console.log("simi minor axis: " + minA);
                
                $("#meanCentered").attr("r", sma);
                
                $("#ellipticalOrbit").attr("rx",sma);
                $("#ellipticalOrbit").attr("ry",minA);
                $("#meanEccentric").attr("r", sma);
                
                $("#focus").attr("cx", c);
                
                var transformStr = "translate(-cx, 0) rotate(d, cx, 0) ";
                
                transformStr = transformStr.replaceAll("cx", c);                
                transformStr = transformStr.replace("d", -LnPe*180/pi);
                console.log(transformStr);
                
                $("#ellipticalGroup").attr("transform",transformStr);
                
                cx = sma * Math.cos(LnPe + mean0);
                cy = -sma * Math.sin(LnPe + mean0);
                
                $("#planet_meanConcentric").attr("cx", cx);
                $("#planet_meanConcentric").attr("cy", cy);
                
                ecx = c * Math.cos(LnPe);
                ecy = -c * Math.sin(LnPe);
                
                $("#planet_meanEccentric").attr("cx", cx - ecx);
                $("#planet_meanEccentric").attr("cy", cy - ecy);
                
                $("#planet").attr("cx", cx - ecx);
                $("#planet").attr("cy", cy - ecy);
            }
            
            function updatePosition(){
                
                var y = $("input[name='year'").val()-1;
                var d = $("input[name='day'").val()-1;
                
                var t = convertDateToSeconds(y,d,0,0);

                var M = planet.MeanLnAtTimeT(t)
                var cx_meanC = sma * Math.cos(M);
                var cy_meanC = -sma * Math.sin(M);
                
                $("#planet_meanConcentric").attr("cx", cx_meanC);
                $("#planet_meanConcentric").attr("cy", cy_meanC);
                
                var cx_meanE = cx_meanC - ecx;
                var cy_meanE = cy_meanC - ecy;
                
                $("#planet_meanEccentric").attr("cx", cx_meanE);
                $("#planet_meanEccentric").attr("cy", cy_meanE);
                
                var lnt = planet.LnAtTimeT(t);
                var r = scale(planet.rAtLn(lnt));
                
                var cx_ellip = r * Math.cos(lnt);
                var cy_ellip = -r * Math.sin(lnt);
                
                $("#planet").attr("cx", cx_ellip);
                $("#planet").attr("cy", cy_ellip);
            }
            
            
            function updateTransferOrbit(){
                
                var pi = Math.atan(1) * 4;
                var data = "M ox oy A rx ry ang 0 0 dx dy A rx ry ang 0 0 ox oy";

                var ox = -80;   //txOrbit.ro * Math.cos(txOrbit.Ln_o);
                var oy = 0;     //-txOrbit.ro * Math.sin(txOrbit.Ln_o);
                var ang = 0;    //-txOrbit.Ln_d * 180/pi;
                var rx = 540;  //txOrbit.a;
                var ry = 480;  //txOrbit.b;
                var dx = 1000;  //txOrbit.rd * Math.cos(txOrbit.Ln_d);
                var dy = 0;     //-txOrbit.rd * Math.sin(txOrbit.Ln_d);

                data = data.replaceAll("ox", ox);
                data = data.replaceAll("oy", oy);
                data = data.replaceAll("ang", ang)
                data = data.replaceAll("rx", rx);
                data = data.replaceAll("ry", ry);
                data = data.replaceAll("dx", dx);
                data = data.replaceAll("dy", dy);

                $("#txOrbit").attr("d", data);

                 // transfer line
                $("#line1").attr("x1", ox);
                $("#line1").attr("y1", oy);

                $("#line1").attr("x2", dx);
                $("#line1").attr("y2", dy);

                $("#line1").attr("stroke", "gray");
            }
            
            $(document).ready(function(){
                console.log("document ready");
                //getPlanetsXML(drawOrbits)
                
                updateTransferOrbit();
                });

        </script>
        
    </head>
    
    <div id="settings">
        
        <form name="settings">
            <input name="year" type="number" value="1" onchange="updatePosition()"/>
            <input name="day" type="number" value="1" onchange="updatePosition()"/>
            <br>
            <input name="zoomSlider" type="range" min="1" max="10" value="1" onchange="zoomSVG()"/>
        </form>
        
        <p>Current Time : <span id="currentTime">00:00</span></p>
        
    </div>
        
    <div id="viewer" height=600 width=600>
        
        <svg id="solarSystem" height="600" width="600" viewBox="0 -1200 1200 2400" onclick="togglePause"  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            
            
            <circle cx="0" cy="0" r="60" stroke="black" fill="cyan"/>
            
            <!-- MOON ORBITs -->
            
            <circle id="meanCentered" cx="0" cy="0" r="1200" fill="none" stroke="black" stroke-width="2" stroke-dashArray="5,3"/>
            <circle id="meanCentered" cx="0" cy="0" r="4700" fill="none" stroke="black" stroke-width="5" stroke-dashArray="5,3"/>
            
            <!-- PLANETS -->
          
            <circle id="mun" cx="1200" cy="0" r="20" fill="gray" stroke = "black"/>
            <circle id="mun_soi" cx="1200" cy="0" r="243" fill="none" stroke = "blue"/>
            
            <circle id="minmus" cx="4700" cy="0" r="60" fill="gray" stroke = "black"/>
            
            <circle cx=0 cy=0 r=80 stroke="red" fill="none"/>
            
            <!-- transfer orbit -->
            <path id="txOrbit"  stroke="gray" fill="none"/>
            <line id="line1" x1="0" y1="0" x2="120" y2="120"/>
            
        </svg>
    </div>
</html>